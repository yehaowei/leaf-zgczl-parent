(function(d){var a=d.getOptions(),b=a.plotOptions,c=d.seriesTypes,g=d.merge,e=function(){},f=d.each;b.funnel=g(b.pie,{center:["50%","50%"],width:"90%",neckWidth:"30%",height:"100%",neckHeight:"25%",reversed:false,dataLabels:{connectorWidth:1,connectorColor:"#606060"},size:true,states:{select:{color:"#C0C0C0",borderColor:"#000000",shadow:false}}});c.funnel=d.extendClass(c.pie,{type:"funnel",animate:e,singularTooltips:true,translate:function(){var j=function(M,L){return(/%$/).test(M)?L*parseInt(M,10)/100:parseInt(M,10)},l=0,u=this,x=u.chart,o=u.options,k=o.reversed,r=x.plotWidth,F=x.plotHeight,A=0,J=o.center,t=j(J[0],r),s=j(J[0],F),B=j(o.width,r),I,w,y=j(o.height,F),v=j(o.neckWidth,r),n=j(o.neckHeight,F),p=y-n,K=u.data,z,q,D=o.dataLabels.position==="left"?1:0,H,m,G,E,i,C,h;u.getWidthAt=w=function(L){return L>y-n||y===n?v:v+(B-v)*((y-n-L)/(y-n))};u.getX=function(M,L){return t+(L?-1:1)*((w(k?F-M:M)/2)+o.dataLabels.distance)};u.center=[t,s,y];u.centerX=t;f(K,function(L){l+=L.y});f(K,function(L){h=null;q=l?L.y/l:0;m=s-y/2+A*y;i=m+q*y;I=w(m);H=t-I/2;G=H+I;I=w(i);E=t-I/2;C=E+I;if(m>p){H=E=t-v/2;G=C=t+v/2}else{if(i>p){h=i;I=w(p);E=t-I/2;C=E+I;i=p}}if(k){m=y-m;i=y-i;h=(h?y-h:null)}z=["M",H,m,"L",G,m,C,i];if(h){z.push(C,h,E,h)}z.push(E,i,"Z");L.shapeType="path";L.shapeArgs={d:z};L.percentage=q*100;L.plotX=t;L.plotY=(m+(h||i))/2;L.tooltipPos=[t,L.plotY];L.slice=e;L.half=D;A+=q})},drawPoints:function(){var i=this,h=i.options,j=i.chart,k=j.renderer;f(i.data,function(l){var n=l.graphic,m=l.shapeArgs;if(!n){l.graphic=k.path(m).attr({fill:l.color,stroke:h.borderColor,"stroke-width":h.borderWidth}).add(i.group)}else{n.animate(m)}})},sortByAngle:function(h){h.sort(function(j,i){return j.plotY-i.plotY})},drawDataLabels:function(){var n=this.data,o=this.options.dataLabels.distance,m,k,j,l=n.length,h,p;this.center[2]-=2*o;while(l--){j=n[l];m=j.half;k=m?1:-1;p=j.plotY;h=this.getX(p,m);j.labelPos=[0,p,h+(o-5)*k,p,h+o*k,p,m?"right":"left",0]}c.pie.prototype.drawDataLabels.call(this)}});a.plotOptions.pyramid=d.merge(a.plotOptions.funnel,{neckWidth:"0%",neckHeight:"0%",reversed:true});d.seriesTypes.pyramid=d.extendClass(d.seriesTypes.funnel,{type:"pyramid"})}($L.Charts));